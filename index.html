<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>webapilab</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/css/materialize.css">

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/js/materialize.js"></script>
</head>

<body ng-app="webapilab" ng-controller="membersController as vm">
    <div class="section no-pad-bot" id="index-banner">
        <div class="container">
            <h1 class="header center orange-text">ASP.NET Web API Lab</h1>
            <div class="row center">
                <h5 class="header col s12 light">Materialize. A modern responsive front-end framework based on Material Design</h5>
            </div>
            <div class="row center">
                <a ng-click="vm.getMembers()" class="btn waves-effect waves-light orange">Get members</a>
            </div>
        </div>
    </div>

    <div class="row" data-source="members">
        <div ng-repeat="member in vm.members">
            <card-Member info="member"></card-Member>
        </div>
    </div>

    <script type="text/javascript">
    var webapilab = angular.module('webapilab', []);

    webapilab.controller('membersController', membersController);

    webapilab.directive('cardMember', function() {
        return {
            restric: 'A',
            scope: {
                memberInfo: '=info'
            },
            template: "<div class='col s12 m6'><div class='card blue-grey darken-1'><div class='card-content white-text'><span class='card-title'>{{memberInfo.Surname}}, {{memberInfo.Name}}</span><p>{{memberInfo.Departament}}&nbsp;</p></div></div></div>"
        };
    });

    function membersController() {
        var vm = this;
        vm.members = [];

        vm.getMembers = function() {
            var url = "http://webapi21668.azurewebsites.net/api/members";
            $.get(url).done(function(data, textStatus, jqXHR) {
                var controllerElement = document.querySelector('[ng-controller="membersController as vm"]');
                var $scope = angular.element(controllerElement).scope();
                $scope.$apply(function() {
                    $scope.vm.members = data;
                });
            }).fail(function(jqXHR, textStatus, errorThrown) {

            }).always(function(data, textStatus, jqXHR) {

            });
        };
    }
    </script>
</body>

</html>
